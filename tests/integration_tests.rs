use siskin::ExecutionResult;

#[test]
fn variable_scoping() -> ExecutionResult {
    let code = "\
        var a = \"global a\";\n\
        var b = \"global b\";\n\
        var c = \"global c\";\n\
        {\n\
            var a = \"outer a\";\n\
            var b = \"outer b\";\n\
            {\n\
                var a = \"inner a\";\n\
                print a;\n\
                print b;\n\
                print c;\n\
            }\n\
            print a;\n\
            print b;\n\
            print c;\n\
        }\n\
        print a;\n\
        print b;\n\
        print c;";

    let mut buffer = Vec::new();
    let mut env = siskin::Environment::new(&mut buffer);
    siskin::execute(code, &mut env)?;

    let output = std::str::from_utf8(&buffer.as_slice())?;

    // println!("Test output was:");
    // println!("{}", output);

    let expected = "\
        inner a\n\
        outer b\n\
        global c\n\
        outer a\n\
        outer b\n\
        global c\n\
        global a\n\
        global b\n\
        global c\n";

    assert_eq!(expected, output);

    Ok(())
}
